<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Google Sheets API v4 Auth Flow • googlesheets4</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../jquery.sticky-kit.min.js"></script><script src="../../pkgdown.js"></script><meta property="og:title" content="Google Sheets API v4 Auth Flow">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../index.html">googlesheets4</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/googlesheets4-design-notes.html">googlesheets4 design notes</a>
    </li>
    <li>
      <a href="../../articles/articles/sheets-api-v4.html">Google Sheets API v4</a>
    </li>
    <li>
      <a href="../../articles/articles/sheets-auth-flow.html">Google Sheets API v4 Auth Flow</a>
    </li>
    <li>
      <a href="../../articles/whatever.html">Imagine a vignette</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/tidyverse/googlesheets4">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Google Sheets API v4 Auth Flow</h1>
            
      
      <small>Source: <a href="https:/github.com/tidyverse/googlesheets4/blob/master/vignettes/articles/sheets-auth-flow.Rmd"><code>vignettes/articles/sheets-auth-flow.Rmd</code></a></small>

    </div>

    
    
<div class="contents">
<div id="authorize-requests" class="section level2">
<h2 class="hasAnchor">
<a href="#authorize-requests" class="anchor"></a>Authorize Requests</h2>
<p>Quoting from:</p>
<p><a href="https://developers.google.com/sheets/api/guides/authorizing" class="uri">https://developers.google.com/sheets/api/guides/authorizing</a></p>
<blockquote>
<p>Every request your application sends to the Google Sheets API needs to identify your application to Google. There are two ways to identify your application: using <strong>an OAuth 2.0 token (which also authorizes the request)</strong> and/or using <strong>the application’s API key</strong>. Here’s how to determine which of those options to use:</p>
<ul>
<li>If the request requires authorization (such as a request for an individual’s private data), then the application must provide an OAuth 2.0 token with the request. The application may also provide the API key, but it doesn’t have to.</li>
<li>If the request doesn’t require authorization (such as a request for public data), then the application must provide either the API key or an OAuth 2.0 token, or both—whatever option is most convenient for you.</li>
</ul>
</blockquote>
</div>
<div id="api-key" class="section level2">
<h2 class="hasAnchor">
<a href="#api-key" class="anchor"></a>API Key</h2>
<p>Proposal: Always send an API key, i.e. just bake this into every request emitted by googlesheets. Consult the following sources for the key, in this order:</p>
<ol style="list-style-type: decimal">
<li>Key specified directly in a <code>gs_whatever()</code> function call.</li>
<li>
<code>Sys.getenv("GOOGLESHEETS_API_KEY")</code>, which gives user a way to set this across multiple function calls, possibly at startup via <code>.Renviron</code>.</li>
<li>
<code>getOption("googlesheets.api.key")</code>, a fallback key baked into the package.</li>
</ol>
<p>Currently implemented as <code>api_key()</code>.</p>
</div>
<div id="oauth" class="section level2">
<h2 class="hasAnchor">
<a href="#oauth" class="anchor"></a>Oauth</h2>
<p>When will I send an OAuth2.0 token?</p>
<div id="v3-post-mortem" class="section level3">
<h3 class="hasAnchor">
<a href="#v3-post-mortem" class="anchor"></a>v3 <em>post mortem</em>
</h3>
<p>The Sheets API v3 has the notion of <a href="https://developers.google.com/sheets/api/guides/migration#visibility"><em>visibility</em></a>:</p>
<blockquote>
<p>The Sheets API v3 expresses visibility directly in its endpoints. A public spreadsheet has been “Published to the Web” and thus can be accessed by the API without authorization, while a private spreadsheet does require authentication.</p>
</blockquote>
<p>Previously, I would inspect the endpoint URL. Presence of <code>private</code> versus <code>public</code> dictated that I would or would not send a token, respectively. But sometimes these URLs were, in fact, constructed by googlesheets itself. There was a moderate current towards building private URLs, even when public was possible. And that could lead to prompts to authenticate when it wasn’t strictly necessary.</p>
<p>This class of aggravation was further exacerbated by the gotcha re: Sheets being “Public on the web” vs “Published to the web”, which was not my fault (<em>btw, I wonder if that’s still a problem?</em>).</p>
</div>
<div id="v4-planning" class="section level3">
<h3 class="hasAnchor">
<a href="#v4-planning" class="anchor"></a>v4 planning</h3>
<p><code>visibility</code> is mercifully now gone:</p>
<blockquote>
<p>In the new Sheets API v4, there is no explicit declaration of visibility. API calls are made using spreadsheet IDs. If the application does not have permission to access specified spreadsheet, an error is returned. Otherwise the call proceeds.</p>
</blockquote>
<p>Thinking out loud:</p>
<ul>
<li>Some endpoints or user-facing tasks will have a universal requirement (or perhaps lack?) for a token. Example of such an endpoint: <code>sheets.spreadsheets.sheets.copyTo</code>. Example of such a task: listing a user’s Sheets. Both of those will absolutely require a token. I will hardwire the inclusion of <code>google_token()</code> into requests built against such an endpoint or into the requests formed in such an operation.</li>
<li>For other endpoints or tasks, the need for a token can only be determined through knowledge of the authenticated user’s relationship to the target Sheet. So I need to make sure all necessary info is stored at registration time.</li>
<li>Open question: if I don’t know whether to send a token, do I default to “send if I have”? Or try-catch and retry with token on failure? Maybe this will never come up. Depends on how registration sorts out.</li>
</ul>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#authorize-requests">Authorize Requests</a></li>
      <li><a href="#api-key">API Key</a></li>
      <li><a href="#oauth">Oauth</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Jennifer Bryan, <a href="https://www.rstudio.com"><img src="http://tidyverse.org/rstudio-logo.svg" alt="RStudio" height="24"></a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
