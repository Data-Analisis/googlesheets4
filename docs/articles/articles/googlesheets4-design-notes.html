<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>googlesheets4 design notes • googlesheets4</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../jquery.sticky-kit.min.js"></script><script src="../../pkgdown.js"></script><meta property="og:title" content="googlesheets4 design notes">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../index.html">googlesheets4</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/googlesheets4-design-notes.html">googlesheets4 design notes</a>
    </li>
    <li>
      <a href="../../articles/articles/sheets-api-v4.html">Google Sheets API v4</a>
    </li>
    <li>
      <a href="../../articles/articles/sheets-auth-flow.html">Google Sheets API v4 Auth Flow</a>
    </li>
    <li>
      <a href="../../articles/whatever.html">Imagine a vignette</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/tidyverse/googlesheets4">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>googlesheets4 design notes</h1>
            
      
      <small>Source: <a href="https:/github.com/tidyverse/googlesheets4/blob/master/vignettes/articles/googlesheets4-design-notes.Rmd"><code>vignettes/articles/googlesheets4-design-notes.Rmd</code></a></small>

    </div>

    
    
<div class="contents">
<p><em>This is useful to me and not necessarily for outside consumption.</em></p>
<div id="peer-group" class="section level2">
<h2 class="hasAnchor">
<a href="#peer-group" class="anchor"></a>Peer group</h2>
<p>Packages to consider in design of googlesheets4:</p>
<ul>
<li>googlesheets: let’s keep the good and fix the bad</li>
<li>readr: reference point for UI, col spec, parsing</li>
<li>readxl: reference point for parsing, (work)sheets/tabs, cell ranges</li>
</ul>
</div>
<div id="col-spec" class="section level2">
<h2 class="hasAnchor">
<a href="#col-spec" class="anchor"></a>Col spec</h2>
<p>All 3 packages provide a way for user to specify the output type of each column.</p>
<p>readr has the col spec system that we are most commited to long-term. <code>col_types</code> accepts a string using a single letter shorthand (e.g. <code>"c"</code> for character), as well as a longer form more conducive to passing ancillary info, such as datetime format. If no column type is given, it is guessed.</p>
<p>googlesheets exposes the readr col spec API. All <code>gs_read*()</code> functions literally call either <code><a href="http://www.rdocumentation.org/packages/readr/topics/read_delim">read_csv()</a></code> or <code><a href="http://www.rdocumentation.org/packages/readr/topics/type_convert">type_convert()</a></code>. This has downsides, primarily the fact that, by default, googlesheets reads and parses <em>formatted</em> cell contents. The good news is that googlesheets did not introduce its own way to describe col spec.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(googlesheets)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="http://www.rdocumentation.org/packages/googlesheets/topics/gs_read">gs_read</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/googlesheets/topics/example-sheets">gs_gap</a></span>(), <span class="dt">ws =</span> <span class="st">"Europe"</span>, <span class="dt">n_max =</span> <span class="dv">4</span>, <span class="dt">col_types =</span> <span class="st">"cciddd"</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#&gt; Accessing worksheet titled 'Europe'.</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt; # A tibble: 4 x 6</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt;   country continent  year lifeExp      pop gdpPercap</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt; 1 Albania Europe     1952    55.2 1282697.     1601.</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#&gt; 2 Albania Europe     1957    59.3 1476505.     1942.</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#&gt; 3 Albania Europe     1962    64.8 1728137.     2313.</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">#&gt; 4 Albania Europe     1967    66.2 1984060.     2760.</span></a></code></pre></div>
<p>readxl has its own col spec system, but it is slated to evolve towards readr. <code>col_types</code> is a character vector with one entry per column from these options: “skip”, “guess”, “logical”, “numeric”, “date”, “text” or “list”. It lacks some of readr’s output types and control: no integers (Excel itself has no concept of integer, but still), no factors, less variety wrt date/time/datetime. The “list” type is unique to readxl and is equally relevant to Google Sheets.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(readxl)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">(clippy &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">read_excel</a></span>(</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  <span class="kw"><a href="http://www.rdocumentation.org/packages/readxl/topics/readxl_example">readxl_example</a></span>(<span class="st">"clippy.xlsx"</span>),</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  <span class="dt">col_types =</span> <span class="kw">c</span>(<span class="st">"text"</span>, <span class="st">"list"</span>))</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt; # A tibble: 4 x 2</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt;   name                 value     </span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt;   &lt;chr&gt;                &lt;list&gt;    </span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt; 1 Name                 &lt;chr [1]&gt; </span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt; 2 Species              &lt;chr [1]&gt; </span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt; 3 Approx date of death &lt;dttm [1]&gt;</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co">#&gt; 4 Weight in grams      &lt;dbl [1]&gt;</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13">tibble<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/tibble/topics/enframe">deframe</a></span>(clippy)</a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co">#&gt; $Name</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co">#&gt; [1] "Clippy"</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co">#&gt; $Species</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="co">#&gt; [1] "paperclip"</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="co">#&gt; $`Approx date of death`</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="co">#&gt; [1] "2007-01-01 UTC"</span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-23" data-line-number="23"><span class="co">#&gt; $`Weight in grams`</span></a>
<a class="sourceLine" id="cb2-24" data-line-number="24"><span class="co">#&gt; [1] 0.9</span></a></code></pre></div>
</div>
<div id="parsing" class="section level2">
<h2 class="hasAnchor">
<a href="#parsing" class="anchor"></a>Parsing</h2>
<p>Given a column type, each cell is processed to produce an atom in a vector of the target type. This is a loop over cells (within a loop over columns).</p>
<p>readxl: We infer type for every cell, either in the guessing pass or at parse time. Cell type inference is based on Excel’s declared cell type, the cell data, and user inputs <code>na</code> and <code>trim_ws</code> (e.g., <a href="https://github.com/tidyverse/readxl/blob/c02f81c3b9f7c6177ed9d13748377450bff9abe1/src/XlsxCell.h#L56" class="uri">https://github.com/tidyverse/readxl/blob/c02f81c3b9f7c6177ed9d13748377450bff9abe1/src/XlsxCell.h#L56</a>).</p>
<p>The cell type and the column type are both enums:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">enum</span> CellType {</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  CELL_UNKNOWN,</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  CELL_BLANK,</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">  CELL_LOGICAL,</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">  CELL_DATE,</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">  CELL_NUMERIC,</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">  CELL_TEXT</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">};</a>
<a class="sourceLine" id="cb3-9" data-line-number="9"></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="kw">enum</span> ColType {</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">  COL_UNKNOWN, <span class="co">// implies column type needs to be guessed</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12">  COL_BLANK,   <span class="co">// occurs when col_types = NULL and observe only CELL_BLANKs</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13">  COL_LOGICAL,</a>
<a class="sourceLine" id="cb3-14" data-line-number="14">  COL_DATE,</a>
<a class="sourceLine" id="cb3-15" data-line-number="15">  COL_NUMERIC,</a>
<a class="sourceLine" id="cb3-16" data-line-number="16">  COL_TEXT,</a>
<a class="sourceLine" id="cb3-17" data-line-number="17">  COL_LIST,    <span class="co">// occurs only as user-specified column type</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18">  COL_SKIP     <span class="co">// occurs only as user-specified column type</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19">};</a></code></pre></div>
<p>There is a large <code>switch()</code> statement that fits a cell of type <em>x</em> into a column of type <em>y</em>. This is simple for matching types, such as <code>CELL_TEXT</code> and <code>COL_TEXT</code>. When it’s not, we must coerce. The simplest coercions are when <code>NA</code> is the only sensible value, such as <code>CELL_LOGICAL</code> to <code>COL_DATE</code>. Examples of trickier coercions: <code>CELL_TEXT</code> to <code>COL_LOGICAL</code> (we use R’s rules for this) or <code>CELL_DATE</code> to <code>COL_TEXT</code> (we can’t really do this right now).</p>
<p>readr. I don’t know it well enough to give same summary. Will do if becomes necessary. The googlesheets4 parsing is more likely to be modelled after readxl anyway, because the info available for each cell is more similar. Presumably there is no notion of “cell type” for readr, since it is always a string.</p>
<p>List of the readr parsers (single character shorthand in parens):</p>
<ul>
<li>
<code><a href="http://www.rdocumentation.org/packages/readr/topics/col_skip">col_skip()</a></code> (_) (-)</li>
<li>
<code><a href="http://www.rdocumentation.org/packages/readr/topics/parse_guess">guess_parser()</a></code> (?)</li>
<li>
<code><a href="http://www.rdocumentation.org/packages/readr/topics/parse_atomic">parse_logical()</a></code> (l)</li>
<li>
<code><a href="http://www.rdocumentation.org/packages/readr/topics/parse_atomic">parse_integer()</a></code> (i)</li>
<li>
<code><a href="http://www.rdocumentation.org/packages/readr/topics/parse_atomic">parse_double()</a></code> (d)</li>
<li>
<code><a href="http://www.rdocumentation.org/packages/readr/topics/parse_number">parse_number()</a></code> (n)</li>
<li>
<code><a href="http://www.rdocumentation.org/packages/readr/topics/parse_datetime">parse_datetime(..., format = "??")</a></code> (T)</li>
<li>
<code><a href="http://www.rdocumentation.org/packages/readr/topics/parse_datetime">parse_date(..., format = "??")</a></code> (D)</li>
<li>
<code><a href="http://www.rdocumentation.org/packages/readr/topics/parse_datetime">parse_time(..., format = "??")</a></code> (t)</li>
<li>
<code><a href="http://www.rdocumentation.org/packages/readr/topics/parse_factor">parse_factor(..., levels = "??")</a></code> <em>why does this not have shortcode? issue opened</em>
</li>
<li>
<code><a href="http://www.rdocumentation.org/packages/readr/topics/parse_atomic">parse_character()</a></code> (c)</li>
</ul>
</div>
<div id="guessing" class="section level2">
<h2 class="hasAnchor">
<a href="#guessing" class="anchor"></a>Guessing</h2>
<p>readxl guesses a col type like so:</p>
<ul>
<li>Determine cell type = cell enum value.</li>
<li>Track cumulative max enum value for the first <code>guess_max</code> cells. Bit of hand-waving here because, while it’s clear that Boolean &lt; integer &lt; double, datetimes are just special.</li>
<li>The max enum value is the guessed col type.</li>
</ul>
<p>readr: I haven’t looked at this. I assume it is also a “max col type” approach.</p>
<p>Observation: It makes sense and is very R-like to take the “maximum” type, i.e. the current pushes everything towards character. Is it worth considering a “majority rules” mentality?</p>
</div>
<div id="google-sheet-cell-data-from-sheets-api-v4" class="section level2">
<h2 class="hasAnchor">
<a href="#google-sheet-cell-data-from-sheets-api-v4" class="anchor"></a>Google Sheet cell data from Sheets API v4</h2>
<p>Two options:</p>
<ul>
<li>
<a href="https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets.values">spreadsheets.values collection</a>: simplest for reading/writing spreadsheet values. Would be nice to use this, but …</li>
<li>
<a href="https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets">spreadsheets collection</a>: for reading/writing any aspect of the spreadsheet. I <em>must</em> use this, at least for reading. Cell typing and coercion demand that we have the contents in various forms (e.g., as entered, unformatted, and formatted), plus information about the format itself.</li>
</ul>
<p>In everything below, I’m suppressing the fact that it’s possible to limit the read to specific cells. Not relevant for picking the endpoint.</p>
<div id="example-sheet" class="section level3">
<h3 class="hasAnchor">
<a href="#example-sheet" class="anchor"></a>Example Sheet</h3>
<p>I’ve built an example Sheet with numeric data, especially datetimes and datetime formulas, to study what’s available for a cell.</p>
<p><a href="https://docs.google.com/spreadsheets/d/1xTUxWGcFLtDIHoYJ1WsjQuLmpUtBf--8Bcu5lQ302SU/edit#gid=0" class="uri">https://docs.google.com/spreadsheets/d/1xTUxWGcFLtDIHoYJ1WsjQuLmpUtBf--8Bcu5lQ302SU/edit#gid=0</a></p>
</div>
<div id="spreadsheets-values-get" class="section level3">
<h3 class="hasAnchor">
<a href="#spreadsheets-values-get" class="anchor"></a>spreadsheets.values.get</h3>
<p><em>This can be skipped, because we will not use this endpoint. But I needed to take a look. It is also the easiest way to juxtapose: as entered, unformatted, formatted.</em></p>
<p><a href="https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets.values/get"><code>spreadsheets.values.get</code></a> has three query parameters:</p>
<ul>
<li>
<code>majorDimension</code>: whether row or column increments fastest in the reply. Boring. Not explored.</li>
<li>
<code>valueRenderOption</code>: An enum:
<ul>
<li>
<code>FORMATTED_VALUE</code> (default): Values calculated &amp; formatted according to the cell’s formatting (automatic or explicit) and spreadsheet’s locale. You basically get the strings that user sees in the browser. Current googlesheets package works with v3 equivalent of this and processes via readr.</li>
<li>
<code>UNFORMATTED_VALUE</code>: Values are calculated but not formatted. Except there’s a loophole: iff the cell has a date-ish format and <code>dateTimeRenderOption = "FORMATTED_STRING"</code>, then those specific cells are handled as if <code>valueRenderOption = "FORMATTED_VALUE"</code>. I don’t see any clever way to exploit this, but just note it.</li>
<li>
<code>FORMULA</code>: Values are not calculated. You get what was entered. If the cell contains a formula, you get that. For non-formula cells, seems to be equivalent to<code>UNFORMATTED_VALUE</code>. Except for the same loophole noted above for cells bearing a date-ish format when <code>dateTimeRenderOption = "FORMATTED_STRING"</code>.</li>
</ul>
</li>
<li>
<code>dateTimeRenderOption</code>: An enum:
<ul>
<li>Ignored if <code>valueRenderOption = "FORMATTED_VALUE"</code>, which is the default.</li>
<li>
<code>SERIAL_NUMBER</code> (default): Cells formatted as date, time, datetime, or duration are output as doubles in “serial number” format. The whole number portion of the value (left of the decimal) counts the days since December 30th 1899. The fractional portion (right of the decimal) counts the time as a fraction of the day. 1900 is not treated as a leap year, i.e. Sheets does not reproduce the Lotus 1-2-3 bug.</li>
<li>
<code>FORMATTED_STRING</code>: Date-ish cells are returned as formatted strings, even if <code>valueRenderOption = "UNFORMATTED_VALUE"</code>.</li>
</ul>
</li>
</ul>
<p><em>hidden chunk here that hits the <code>spreadsheets.values.get</code> endpoint and gets response ready for inspection</em></p>
<p>Side-by-side comparison of <code>FORMATTED_VALUE</code> vs. <code>UNFORMATTED_VALUE</code> vs. <code>FORMULA</code>. Remember this requires 3 separate API calls, i.e. you can’t get all 3 of these from <code>spreadsheet.values</code> at the same time.</p>
<pre><code>#&gt; # A tibble: 30 x 5
#&gt;    as_entered         format    FORMATTED_VALUE   UNFORMATTED_VAL… FORMULA
#&gt;    &lt;chr&gt;              &lt;chr&gt;     &lt;chr&gt;             &lt;chr&gt;            &lt;chr&gt;  
#&gt;  1 3/10/2018 11:11:11 Date time 3/10/2018 11:11:… 43169.466099537  43169.…
#&gt;  2 =TODAY()           automatic 3/18/2018         43177            =TODAY…
#&gt;  3 =TODAY()           Date      3/18/2018         43177            =TODAY…
#&gt;  4 =TODAY()           Time      12:00:00 AM       43177            =TODAY…
#&gt;  5 =TODAY()           Date time 3/18/2018 0:00:00 43177            =TODAY…
#&gt;  6 =TODAY()           Plain te… 43177             43177            =TODAY…
#&gt;  7 =TODAY()           Number    43,177.00         43177            =TODAY…
#&gt;  8 =TODAY()           "From \"… Sunday, March 18… 43177            =TODAY…
#&gt;  9 =now()             automatic 3/18/2018 22:38:… 43177.9432969907 =now() 
#&gt; 10 =now()             Date      3/18/2018         43177.9432969907 =now() 
#&gt; 11 =now()             Time      10:38:21 PM       43177.9432969907 =now() 
#&gt; 12 =now()             Date time 3/18/2018 22:38:… 43177.9432969907 =now() 
#&gt; 13 =now()             Plain te… 43177.9433        43177.9432969907 =now() 
#&gt; 14 =now()             Number    43,177.94         43177.9432969907 =now() 
#&gt; 15 =now()             "From \"… Sunday, March 18… 43177.9432969907 =now() 
#&gt; 16 =EDATE(A9, -4)     automatic 11/18/2017        43057            =EDATE…
#&gt; 17 =EDATE(A9, -4)     Date      11/18/2017        43057            =EDATE…
#&gt; 18 =EDATE(A9, -4)     Time      12:00:00 AM       43057            =EDATE…
#&gt; 19 =EDATE(A9, -4)     Date time 11/18/2017 0:00:… 43057            =EDATE…
#&gt; 20 =EDATE(A9, -4)     Plain te… 43057             43057            =EDATE…
#&gt; 21 =EDATE(A9, -4)     Number    43,057.00         43057            =EDATE…
#&gt; 22 =EDATE(A9, -4)     "From \"… Saturday, Novemb… 43057            =EDATE…
#&gt; 23 0.015              automatic 0.015             0.015            0.015  
#&gt; 24 0.015              Percent   1.50%             0.015            0.015  
#&gt; 25 1.5%               automatic 1.50%             0.015            0.015  
#&gt; 26 1234567890         automatic 1234567890        1234567890       123456…
#&gt; 27 1234567890         Scientif… 1.23E+09          1234567890       123456…
#&gt; 28 $1.23              automatic $1.23             1.23             1.23   
#&gt; 29 $1.23              Currency… $1                1.23             1.23   
#&gt; 30 1.23               Currency  $1.23             1.23             1.23</code></pre>
<p>Here’s a look at same, but combined with <code>dateTimeRenderOption = "FORMATTED_STRING"</code>. Observations:</p>
<ul>
<li>
<code>FORMATTED_VALUE</code> is same as above.</li>
<li>
<code>UNFORMATTED_VALUE</code> is same as <code>FORMATTED_VALUE</code> for cells bearing a date-ish format.</li>
<li>
<code>FORMULA</code> is same as above for formula cells and numbers entered as numbers. I note <code>FORMULA</code> is different in the case of the datetime that was typed in (first row).</li>
</ul>
<pre><code>#&gt; # A tibble: 30 x 5
#&gt;    as_entered         format  FORMATTED_VALUE2  UNFORMATTED_VALU… FORMULA2
#&gt;    &lt;chr&gt;              &lt;chr&gt;   &lt;chr&gt;             &lt;chr&gt;             &lt;chr&gt;   
#&gt;  1 3/10/2018 11:11:11 Date t… 3/10/2018 11:11:… 3/10/2018 11:11:… 3/10/20…
#&gt;  2 =TODAY()           automa… 3/18/2018         3/18/2018         =TODAY()
#&gt;  3 =TODAY()           Date    3/18/2018         3/18/2018         =TODAY()
#&gt;  4 =TODAY()           Time    12:00:00 AM       12:00:00 AM       =TODAY()
#&gt;  5 =TODAY()           Date t… 3/18/2018 0:00:00 3/18/2018 0:00:00 =TODAY()
#&gt;  6 =TODAY()           Plain … 43177             43177             =TODAY()
#&gt;  7 =TODAY()           Number  43,177.00         43177             =TODAY()
#&gt;  8 =TODAY()           "From … Sunday, March 18… Sunday, March 18… =TODAY()
#&gt;  9 =now()             automa… 3/18/2018 22:38:… 3/18/2018 22:38:… =now()  
#&gt; 10 =now()             Date    3/18/2018         3/18/2018         =now()  
#&gt; 11 =now()             Time    10:38:21 PM       10:38:21 PM       =now()  
#&gt; 12 =now()             Date t… 3/18/2018 22:38:… 3/18/2018 22:38:… =now()  
#&gt; 13 =now()             Plain … 43177.9433        43177.9432969907  =now()  
#&gt; 14 =now()             Number  43,177.94         43177.9432969907  =now()  
#&gt; 15 =now()             "From … Sunday, March 18… Sunday, March 18… =now()  
#&gt; 16 =EDATE(A9, -4)     automa… 11/18/2017        11/18/2017        =EDATE(…
#&gt; 17 =EDATE(A9, -4)     Date    11/18/2017        11/18/2017        =EDATE(…
#&gt; 18 =EDATE(A9, -4)     Time    12:00:00 AM       12:00:00 AM       =EDATE(…
#&gt; 19 =EDATE(A9, -4)     Date t… 11/18/2017 0:00:… 11/18/2017 0:00:… =EDATE(…
#&gt; 20 =EDATE(A9, -4)     Plain … 43057             43057             =EDATE(…
#&gt; 21 =EDATE(A9, -4)     Number  43,057.00         43057             =EDATE(…
#&gt; 22 =EDATE(A9, -4)     "From … Saturday, Novemb… Saturday, Novemb… =EDATE(…
#&gt; 23 0.015              automa… 0.015             0.015             0.015   
#&gt; 24 0.015              Percent 1.50%             0.015             0.015   
#&gt; 25 1.5%               automa… 1.50%             0.015             0.015   
#&gt; 26 1234567890         automa… 1234567890        1234567890        1234567…
#&gt; 27 1234567890         Scient… 1.23E+09          1234567890        1234567…
#&gt; 28 $1.23              automa… $1.23             1.23              1.23    
#&gt; 29 $1.23              Curren… $1                1.23              1.23    
#&gt; 30 1.23               Curren… $1.23             1.23              1.23</code></pre>
</div>
<div id="spreadsheets-get" class="section level3">
<h3 class="hasAnchor">
<a href="#spreadsheets-get" class="anchor"></a>spreadsheets.get</h3>
<p><a href="https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets/get"><code>spreadsheets.get</code></a> can return cell data:</p>
<ul>
<li>
<code>includeGridData = "TRUE"</code>: Put this in the query to request cell data. You will get <em>everything</em>.</li>
<li>Field mask. More granular way to specify desired fields in the query. We’ll use this in the long-run, for fine control (see end of this article). I’ve used <code>includeGridData</code> here to see full detail (some of which I am still suppressing).</li>
</ul>
<p><em>hidden chunk here that hits the <code>spreadsheets.get</code> endpoint and gets response ready for inspection</em></p>
<p>If you drill down, the data you get for each cell is an instance of <a href="https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets#CellData"><code>CellData</code></a>.</p>
<p>Here’s (trimmed down) <code>CellData</code> on cell A2, a literal, explicitly formatted datetime:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">str</span>(resp[[<span class="dv">2</span>]])</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt; List of 5</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt;  $ userEnteredValue :List of 1</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt;   ..$ numberValue: num 43169</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt;  $ effectiveValue   :List of 1</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt;   ..$ numberValue: num 43169</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt;  $ formattedValue   : chr "3/10/2018 11:11:11"</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt;  $ userEnteredFormat:List of 1</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#&gt;   ..$ numberFormat:List of 2</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt;   .. ..$ type   : chr "DATE_TIME"</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt;   .. ..$ pattern: chr "M/d/yyyy H:mm:ss"</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co">#&gt;  $ effectiveFormat  :List of 1</span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co">#&gt;   ..$ numberFormat:List of 2</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="co">#&gt;   .. ..$ type   : chr "DATE_TIME"</span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="co">#&gt;   .. ..$ pattern: chr "M/d/yyyy H:mm:ss"</span></a></code></pre></div>
<p>Here’s (trimmed down) <code>CellData</code> on cell A3, an automatically formatted datetime formula:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">str</span>(resp[[<span class="dv">3</span>]])</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt; List of 4</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt;  $ userEnteredValue:List of 1</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt;   ..$ formulaValue: chr "=TODAY()"</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt;  $ effectiveValue  :List of 1</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt;   ..$ numberValue: int 43177</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt;  $ formattedValue  : chr "3/18/2018"</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt;  $ effectiveFormat :List of 1</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt;   ..$ numberFormat:List of 1</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt;   .. ..$ type: chr "DATE"</span></a></code></pre></div>
<p>Observations:</p>
<ul>
<li>
<code>formattedValue</code> is useful for coercing to character, i.e. Google has already done it and, unlike Excel, exposes it. It is the same as what you get from <code>spreadsheets.values.get</code> when <code>valueRenderOption = "FORMATTED_VALUE"</code>.</li>
<li>
<code>userEnteredValue</code> could be used if we aspire to return formulas. It is basically the same as what you get from <code>spreadsheets.values.get</code> when <code>valueRenderOption = "FORMULA"</code>.</li>
<li>
<code>effectiveValue</code> is our main source of cell data. It is basically the same as what you get from <code>spreadsheets.values.get</code> when <code>valueRenderOption = "UNFORMATTED_VALUE"</code>.</li>
<li>
<code>effectiveValue</code> and <code>effectiveFormat</code>, together, provide the basis for cell typing.</li>
<li>
<code>effectiveFormat</code> <em>could</em> provide a basis for transmitting datetime format from the Sheet into R, if we had a lexicon or a grammar for the formats. <a href="https://developers.google.com/sheets/api/guides/formats">Sheets API docs on Date and Number Formats</a>. <a href="https://github.com/WizardMac/TimeFormatStrings">TimeFormatStrings</a>, a C library to read and write time format strings (Excel, Stata, Unicode).</li>
</ul>
<p>Let’s look at these fields for all cells.</p>
<p><code>userEnteredValue</code> and <code>effectiveValue</code> hold an instance of <code>ExtendedValue</code>, which is always exactly one of the following:</p>
<ul>
<li><code>numberValue</code></li>
<li><code>stringValue</code></li>
<li><code>boolValue</code></li>
<li><code>formulaValue</code></li>
<li>
<code>errorValue</code>, which will be an instance of <code>ErrorValue</code>
</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(formattedValue, <span class="kw">starts_with</span>(<span class="st">"user"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="st">  </span><span class="kw">print</span>(<span class="dt">n =</span> <span class="ot">Inf</span>)</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt; # A tibble: 31 x 3</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt;    formattedValue                  userEnteredValue_n… userEnteredValue_v…</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt;    &lt;chr&gt;                           &lt;chr&gt;               &lt;chr&gt;              </span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt;  1 x                               stringValue         x                  </span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt;  2 3/10/2018 11:11:11              numberValue         43169.466100       </span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt;  3 3/18/2018                       formulaValue        =TODAY()           </span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt;  4 3/18/2018                       formulaValue        =TODAY()           </span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt;  5 12:00:00 AM                     formulaValue        =TODAY()           </span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt;  6 3/18/2018 0:00:00               formulaValue        =TODAY()           </span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt;  7 43177                           formulaValue        =TODAY()           </span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt;  8 43,177.00                       formulaValue        =TODAY()           </span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt;  9 Sunday, March 18, 2018 at 12:0… formulaValue        =TODAY()           </span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt; 10 3/18/2018 22:38:21              formulaValue        =now()             </span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="co">#&gt; 11 3/18/2018                       formulaValue        =now()             </span></a>
<a class="sourceLine" id="cb8-18" data-line-number="18"><span class="co">#&gt; 12 10:38:21 PM                     formulaValue        =now()             </span></a>
<a class="sourceLine" id="cb8-19" data-line-number="19"><span class="co">#&gt; 13 3/18/2018 22:38:21              formulaValue        =now()             </span></a>
<a class="sourceLine" id="cb8-20" data-line-number="20"><span class="co">#&gt; 14 43177.9433                      formulaValue        =now()             </span></a>
<a class="sourceLine" id="cb8-21" data-line-number="21"><span class="co">#&gt; 15 43,177.94                       formulaValue        =now()             </span></a>
<a class="sourceLine" id="cb8-22" data-line-number="22"><span class="co">#&gt; 16 Sunday, March 18, 2018 at 10:3… formulaValue        =now()             </span></a>
<a class="sourceLine" id="cb8-23" data-line-number="23"><span class="co">#&gt; 17 11/18/2017                      formulaValue        =EDATE(A10, -4)    </span></a>
<a class="sourceLine" id="cb8-24" data-line-number="24"><span class="co">#&gt; 18 11/18/2017                      formulaValue        =EDATE(A11, -4)    </span></a>
<a class="sourceLine" id="cb8-25" data-line-number="25"><span class="co">#&gt; 19 12:00:00 AM                     formulaValue        =EDATE(A12, -4)    </span></a>
<a class="sourceLine" id="cb8-26" data-line-number="26"><span class="co">#&gt; 20 11/18/2017 0:00:00              formulaValue        =EDATE(A13, -4)    </span></a>
<a class="sourceLine" id="cb8-27" data-line-number="27"><span class="co">#&gt; 21 43057                           formulaValue        =EDATE(A14, -4)    </span></a>
<a class="sourceLine" id="cb8-28" data-line-number="28"><span class="co">#&gt; 22 43,057.00                       formulaValue        =EDATE(A15, -4)    </span></a>
<a class="sourceLine" id="cb8-29" data-line-number="29"><span class="co">#&gt; 23 Saturday, November 18, 2017 at… formulaValue        =EDATE(A16, -4)    </span></a>
<a class="sourceLine" id="cb8-30" data-line-number="30"><span class="co">#&gt; 24 0.015                           numberValue         0.015000           </span></a>
<a class="sourceLine" id="cb8-31" data-line-number="31"><span class="co">#&gt; 25 1.50%                           numberValue         0.015000           </span></a>
<a class="sourceLine" id="cb8-32" data-line-number="32"><span class="co">#&gt; 26 1.50%                           numberValue         0.015000           </span></a>
<a class="sourceLine" id="cb8-33" data-line-number="33"><span class="co">#&gt; 27 1234567890                      numberValue         1234567890         </span></a>
<a class="sourceLine" id="cb8-34" data-line-number="34"><span class="co">#&gt; 28 1.23E+09                        numberValue         1234567890         </span></a>
<a class="sourceLine" id="cb8-35" data-line-number="35"><span class="co">#&gt; 29 $1.23                           numberValue         1.230000           </span></a>
<a class="sourceLine" id="cb8-36" data-line-number="36"><span class="co">#&gt; 30 $1                              numberValue         1.230000           </span></a>
<a class="sourceLine" id="cb8-37" data-line-number="37"><span class="co">#&gt; 31 $1.23                           numberValue         1.230000</span></a></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(formattedValue, <span class="kw">starts_with</span>(<span class="st">"effectiveValue"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span><span class="kw">print</span>(<span class="dt">n =</span> <span class="ot">Inf</span>)</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#&gt; # A tibble: 31 x 3</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#&gt;    formattedValue                    effectiveValue_na… effectiveValue_va…</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#&gt;    &lt;chr&gt;                             &lt;chr&gt;              &lt;chr&gt;             </span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co">#&gt;  1 x                                 stringValue        x                 </span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="co">#&gt;  2 3/10/2018 11:11:11                numberValue        43169.466100      </span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="co">#&gt;  3 3/18/2018                         numberValue        43177             </span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="co">#&gt;  4 3/18/2018                         numberValue        43177             </span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="co">#&gt;  5 12:00:00 AM                       numberValue        43177             </span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="co">#&gt;  6 3/18/2018 0:00:00                 numberValue        43177             </span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="co">#&gt;  7 43177                             numberValue        43177             </span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="co">#&gt;  8 43,177.00                         numberValue        43177             </span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="co">#&gt;  9 Sunday, March 18, 2018 at 12:00:… numberValue        43177             </span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16"><span class="co">#&gt; 10 3/18/2018 22:38:21                numberValue        43177.943297      </span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17"><span class="co">#&gt; 11 3/18/2018                         numberValue        43177.943297      </span></a>
<a class="sourceLine" id="cb9-18" data-line-number="18"><span class="co">#&gt; 12 10:38:21 PM                       numberValue        43177.943297      </span></a>
<a class="sourceLine" id="cb9-19" data-line-number="19"><span class="co">#&gt; 13 3/18/2018 22:38:21                numberValue        43177.943297      </span></a>
<a class="sourceLine" id="cb9-20" data-line-number="20"><span class="co">#&gt; 14 43177.9433                        numberValue        43177.943297      </span></a>
<a class="sourceLine" id="cb9-21" data-line-number="21"><span class="co">#&gt; 15 43,177.94                         numberValue        43177.943297      </span></a>
<a class="sourceLine" id="cb9-22" data-line-number="22"><span class="co">#&gt; 16 Sunday, March 18, 2018 at 10:38:… numberValue        43177.943297      </span></a>
<a class="sourceLine" id="cb9-23" data-line-number="23"><span class="co">#&gt; 17 11/18/2017                        numberValue        43057             </span></a>
<a class="sourceLine" id="cb9-24" data-line-number="24"><span class="co">#&gt; 18 11/18/2017                        numberValue        43057             </span></a>
<a class="sourceLine" id="cb9-25" data-line-number="25"><span class="co">#&gt; 19 12:00:00 AM                       numberValue        43057             </span></a>
<a class="sourceLine" id="cb9-26" data-line-number="26"><span class="co">#&gt; 20 11/18/2017 0:00:00                numberValue        43057             </span></a>
<a class="sourceLine" id="cb9-27" data-line-number="27"><span class="co">#&gt; 21 43057                             numberValue        43057             </span></a>
<a class="sourceLine" id="cb9-28" data-line-number="28"><span class="co">#&gt; 22 43,057.00                         numberValue        43057             </span></a>
<a class="sourceLine" id="cb9-29" data-line-number="29"><span class="co">#&gt; 23 Saturday, November 18, 2017 at 1… numberValue        43057             </span></a>
<a class="sourceLine" id="cb9-30" data-line-number="30"><span class="co">#&gt; 24 0.015                             numberValue        0.015000          </span></a>
<a class="sourceLine" id="cb9-31" data-line-number="31"><span class="co">#&gt; 25 1.50%                             numberValue        0.015000          </span></a>
<a class="sourceLine" id="cb9-32" data-line-number="32"><span class="co">#&gt; 26 1.50%                             numberValue        0.015000          </span></a>
<a class="sourceLine" id="cb9-33" data-line-number="33"><span class="co">#&gt; 27 1234567890                        numberValue        1234567890        </span></a>
<a class="sourceLine" id="cb9-34" data-line-number="34"><span class="co">#&gt; 28 1.23E+09                          numberValue        1234567890        </span></a>
<a class="sourceLine" id="cb9-35" data-line-number="35"><span class="co">#&gt; 29 $1.23                             numberValue        1.230000          </span></a>
<a class="sourceLine" id="cb9-36" data-line-number="36"><span class="co">#&gt; 30 $1                                numberValue        1.230000          </span></a>
<a class="sourceLine" id="cb9-37" data-line-number="37"><span class="co">#&gt; 31 $1.23                             numberValue        1.230000</span></a></code></pre></div>
<p><code>effectiveFormat</code>, if it exists, holds an instance of <code>CellFormat</code>. We only care about the sub-component <code>NumberFormat</code>. If it exists, <code>NumberFormat</code> has a <code>type</code> and possibly a <code>pattern</code>. Possible values for <code>type</code> of <code>NumberFormat</code>:</p>
<ul>
<li><code>TEXT</code></li>
<li><code>NUMBER</code></li>
<li><code>PERCENT</code></li>
<li><code>CURRENCY</code></li>
<li><code>DATE</code></li>
<li><code>TIME</code></li>
<li><code>DATE_TIME</code></li>
<li><code>SCIENTIFIC</code></li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(formattedValue, <span class="kw">starts_with</span>(<span class="st">"effectiveFormat"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="st">  </span><span class="kw">print</span>(<span class="dt">n =</span> <span class="ot">Inf</span>)</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt; # A tibble: 31 x 3</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt;    formattedValue         effectiveFormat_n… effectiveFormat_nf_pattern   </span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt;    &lt;chr&gt;                  &lt;chr&gt;              &lt;chr&gt;                        </span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt;  1 x                      &lt;NA&gt;               &lt;NA&gt;                         </span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt;  2 3/10/2018 11:11:11     DATE_TIME          M/d/yyyy H:mm:ss             </span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt;  3 3/18/2018              DATE               &lt;NA&gt;                         </span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt;  4 3/18/2018              DATE               M/d/yyyy                     </span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt;  5 12:00:00 AM            TIME               h:mm:ss am/pm                </span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt;  6 3/18/2018 0:00:00      DATE_TIME          M/d/yyyy H:mm:ss             </span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt;  7 43177                  TEXT               &lt;NA&gt;                         </span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt;  8 43,177.00              NUMBER             #,##0.00                     </span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt;  9 Sunday, March 18, 201… DATE_TIME          "dddd\", \"mmmm\" \"d\", \"y…</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="co">#&gt; 10 3/18/2018 22:38:21     DATE_TIME          &lt;NA&gt;                         </span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17"><span class="co">#&gt; 11 3/18/2018              DATE               M/d/yyyy                     </span></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="co">#&gt; 12 10:38:21 PM            TIME               h:mm:ss am/pm                </span></a>
<a class="sourceLine" id="cb10-19" data-line-number="19"><span class="co">#&gt; 13 3/18/2018 22:38:21     DATE_TIME          M/d/yyyy H:mm:ss             </span></a>
<a class="sourceLine" id="cb10-20" data-line-number="20"><span class="co">#&gt; 14 43177.9433             TEXT               &lt;NA&gt;                         </span></a>
<a class="sourceLine" id="cb10-21" data-line-number="21"><span class="co">#&gt; 15 43,177.94              NUMBER             #,##0.00                     </span></a>
<a class="sourceLine" id="cb10-22" data-line-number="22"><span class="co">#&gt; 16 Sunday, March 18, 201… DATE_TIME          "dddd\", \"mmmm\" \"d\", \"y…</span></a>
<a class="sourceLine" id="cb10-23" data-line-number="23"><span class="co">#&gt; 17 11/18/2017             DATE               &lt;NA&gt;                         </span></a>
<a class="sourceLine" id="cb10-24" data-line-number="24"><span class="co">#&gt; 18 11/18/2017             DATE               M/d/yyyy                     </span></a>
<a class="sourceLine" id="cb10-25" data-line-number="25"><span class="co">#&gt; 19 12:00:00 AM            TIME               h:mm:ss am/pm                </span></a>
<a class="sourceLine" id="cb10-26" data-line-number="26"><span class="co">#&gt; 20 11/18/2017 0:00:00     DATE_TIME          M/d/yyyy H:mm:ss             </span></a>
<a class="sourceLine" id="cb10-27" data-line-number="27"><span class="co">#&gt; 21 43057                  TEXT               &lt;NA&gt;                         </span></a>
<a class="sourceLine" id="cb10-28" data-line-number="28"><span class="co">#&gt; 22 43,057.00              NUMBER             #,##0.00                     </span></a>
<a class="sourceLine" id="cb10-29" data-line-number="29"><span class="co">#&gt; 23 Saturday, November 18… DATE_TIME          "dddd\", \"mmmm\" \"d\", \"y…</span></a>
<a class="sourceLine" id="cb10-30" data-line-number="30"><span class="co">#&gt; 24 0.015                  &lt;NA&gt;               &lt;NA&gt;                         </span></a>
<a class="sourceLine" id="cb10-31" data-line-number="31"><span class="co">#&gt; 25 1.50%                  PERCENT            0.00%                        </span></a>
<a class="sourceLine" id="cb10-32" data-line-number="32"><span class="co">#&gt; 26 1.50%                  PERCENT            0.00%                        </span></a>
<a class="sourceLine" id="cb10-33" data-line-number="33"><span class="co">#&gt; 27 1234567890             &lt;NA&gt;               &lt;NA&gt;                         </span></a>
<a class="sourceLine" id="cb10-34" data-line-number="34"><span class="co">#&gt; 28 1.23E+09               SCIENTIFIC         0.00E+00                     </span></a>
<a class="sourceLine" id="cb10-35" data-line-number="35"><span class="co">#&gt; 29 $1.23                  CURRENCY           "\"$\"#,##0.00"              </span></a>
<a class="sourceLine" id="cb10-36" data-line-number="36"><span class="co">#&gt; 30 $1                     CURRENCY           "\"$\"#,##0"                 </span></a>
<a class="sourceLine" id="cb10-37" data-line-number="37"><span class="co">#&gt; 31 $1.23                  CURRENCY           "\"$\"#,##0.00"</span></a></code></pre></div>
<p>A cell will not have an <code>effectiveFormat</code> if it bears the <code>defaultFormat</code>, which is a <a href="https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets#spreadsheetproperties">property of the enclosing spreadsheet</a>.</p>
<p>A cell with an <code>effectiveFormat</code> does not necessarily have a <code>NumberFormat</code>, indicated by <code>NA</code> above. A cell with a <code>NumberFormat</code> does not necessarily have a <code>pattern</code>, indicated by <code>NA</code> above. That means a default pattern for that type is selected based on the user’s locale. <em><a href="https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets#NumberFormat">The docs</a> say “user’s locale” and in other places are careful to say “spreadsheet’s locale”. Not sure if this is sloppiness or is significant.</em></p>
</div>
<div id="spreadsheets-values-get-vs-spreadsheets-get" class="section level3">
<h3 class="hasAnchor">
<a href="#spreadsheets-values-get-vs-spreadsheets-get" class="anchor"></a>spreadsheets.values.get vs. spreadsheets.get</h3>
<p>Nailing down my understanding of the two endpoints.</p>
<p>Claim: cell values returned by <code>spreadsheets.values.get</code> when <code>valueRenderOption = "FORMATTED_VALUE"</code> (default) are same as <code>formattedValue</code> from <code>spreadsheets.get</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">  <span class="dt">ss_values_get =</span> val_df<span class="op">$</span>FORMATTED_VALUE,</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">  <span class="dt">ss_get =</span> df<span class="op">$</span>formattedValue[<span class="op">-</span><span class="dv">1</span>],</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">  <span class="dt">same =</span> ss_values_get <span class="op">==</span><span class="st"> </span>ss_get,</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">  <span class="dt">fla =</span> val_df<span class="op">$</span>FORMULA</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">str_detect</span>(val_df<span class="op">$</span>FORMULA, <span class="st">"now"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>fla) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="st">  </span><span class="kw">print</span>(<span class="dt">n =</span> <span class="ot">Inf</span>)</a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#&gt; # A tibble: 23 x 3</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co">#&gt;    ss_values_get                              ss_get                 same </span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">#&gt;    &lt;chr&gt;                                      &lt;chr&gt;                  &lt;lgl&gt;</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt;  1 3/10/2018 11:11:11                         3/10/2018 11:11:11     TRUE </span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="co">#&gt;  2 3/18/2018                                  3/18/2018              TRUE </span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="co">#&gt;  3 3/18/2018                                  3/18/2018              TRUE </span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="co">#&gt;  4 12:00:00 AM                                12:00:00 AM            TRUE </span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="co">#&gt;  5 3/18/2018 0:00:00                          3/18/2018 0:00:00      TRUE </span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="co">#&gt;  6 43177                                      43177                  TRUE </span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="co">#&gt;  7 43,177.00                                  43,177.00              TRUE </span></a>
<a class="sourceLine" id="cb11-20" data-line-number="20"><span class="co">#&gt;  8 Sunday, March 18, 2018 at 12:00:00 AM      Sunday, March 18, 201… TRUE </span></a>
<a class="sourceLine" id="cb11-21" data-line-number="21"><span class="co">#&gt;  9 11/18/2017                                 11/18/2017             TRUE </span></a>
<a class="sourceLine" id="cb11-22" data-line-number="22"><span class="co">#&gt; 10 11/18/2017                                 11/18/2017             TRUE </span></a>
<a class="sourceLine" id="cb11-23" data-line-number="23"><span class="co">#&gt; 11 12:00:00 AM                                12:00:00 AM            TRUE </span></a>
<a class="sourceLine" id="cb11-24" data-line-number="24"><span class="co">#&gt; 12 11/18/2017 0:00:00                         11/18/2017 0:00:00     TRUE </span></a>
<a class="sourceLine" id="cb11-25" data-line-number="25"><span class="co">#&gt; 13 43057                                      43057                  TRUE </span></a>
<a class="sourceLine" id="cb11-26" data-line-number="26"><span class="co">#&gt; 14 43,057.00                                  43,057.00              TRUE </span></a>
<a class="sourceLine" id="cb11-27" data-line-number="27"><span class="co">#&gt; 15 Saturday, November 18, 2017 at 12:00:00 AM Saturday, November 18… TRUE </span></a>
<a class="sourceLine" id="cb11-28" data-line-number="28"><span class="co">#&gt; 16 0.015                                      0.015                  TRUE </span></a>
<a class="sourceLine" id="cb11-29" data-line-number="29"><span class="co">#&gt; 17 1.50%                                      1.50%                  TRUE </span></a>
<a class="sourceLine" id="cb11-30" data-line-number="30"><span class="co">#&gt; 18 1.50%                                      1.50%                  TRUE </span></a>
<a class="sourceLine" id="cb11-31" data-line-number="31"><span class="co">#&gt; 19 1234567890                                 1234567890             TRUE </span></a>
<a class="sourceLine" id="cb11-32" data-line-number="32"><span class="co">#&gt; 20 1.23E+09                                   1.23E+09               TRUE </span></a>
<a class="sourceLine" id="cb11-33" data-line-number="33"><span class="co">#&gt; 21 $1.23                                      $1.23                  TRUE </span></a>
<a class="sourceLine" id="cb11-34" data-line-number="34"><span class="co">#&gt; 22 $1                                         $1                     TRUE </span></a>
<a class="sourceLine" id="cb11-35" data-line-number="35"><span class="co">#&gt; 23 $1.23                                      $1.23                  TRUE</span></a></code></pre></div>
<p>TRUE. My use of the <code>now()</code> datetime formula in the example spreadsheet is regrettable here, hence those rows are filtered out.</p>
<p>Claim: cell values returned by <code>spreadsheets.values.get</code> when <code>valueRenderOption = "UNFORMATTED_VALUE"</code> are same as <code>effectiveValue</code> from <code>spreadsheets.get</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">  <span class="dt">ss_values_get =</span> val_df<span class="op">$</span>UNFORMATTED_VALUE,</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">  <span class="dt">ss_get =</span> df<span class="op">$</span>effectiveValue_value[<span class="op">-</span><span class="dv">1</span>],</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">  <span class="dt">same =</span> ss_values_get <span class="op">==</span><span class="st"> </span>ss_get,</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">  <span class="dt">fla =</span> val_df<span class="op">$</span>FORMULA</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">str_detect</span>(val_df<span class="op">$</span>FORMULA, <span class="st">"now"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>fla) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="st">  </span><span class="kw">print</span>(<span class="dt">n =</span> <span class="ot">Inf</span>)</a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="co">#&gt; # A tibble: 23 x 3</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="co">#&gt;    ss_values_get   ss_get       same </span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="co">#&gt;    &lt;chr&gt;           &lt;chr&gt;        &lt;lgl&gt;</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13"><span class="co">#&gt;  1 43169.466099537 43169.466100 FALSE</span></a>
<a class="sourceLine" id="cb12-14" data-line-number="14"><span class="co">#&gt;  2 43177           43177        TRUE </span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15"><span class="co">#&gt;  3 43177           43177        TRUE </span></a>
<a class="sourceLine" id="cb12-16" data-line-number="16"><span class="co">#&gt;  4 43177           43177        TRUE </span></a>
<a class="sourceLine" id="cb12-17" data-line-number="17"><span class="co">#&gt;  5 43177           43177        TRUE </span></a>
<a class="sourceLine" id="cb12-18" data-line-number="18"><span class="co">#&gt;  6 43177           43177        TRUE </span></a>
<a class="sourceLine" id="cb12-19" data-line-number="19"><span class="co">#&gt;  7 43177           43177        TRUE </span></a>
<a class="sourceLine" id="cb12-20" data-line-number="20"><span class="co">#&gt;  8 43177           43177        TRUE </span></a>
<a class="sourceLine" id="cb12-21" data-line-number="21"><span class="co">#&gt;  9 43057           43057        TRUE </span></a>
<a class="sourceLine" id="cb12-22" data-line-number="22"><span class="co">#&gt; 10 43057           43057        TRUE </span></a>
<a class="sourceLine" id="cb12-23" data-line-number="23"><span class="co">#&gt; 11 43057           43057        TRUE </span></a>
<a class="sourceLine" id="cb12-24" data-line-number="24"><span class="co">#&gt; 12 43057           43057        TRUE </span></a>
<a class="sourceLine" id="cb12-25" data-line-number="25"><span class="co">#&gt; 13 43057           43057        TRUE </span></a>
<a class="sourceLine" id="cb12-26" data-line-number="26"><span class="co">#&gt; 14 43057           43057        TRUE </span></a>
<a class="sourceLine" id="cb12-27" data-line-number="27"><span class="co">#&gt; 15 43057           43057        TRUE </span></a>
<a class="sourceLine" id="cb12-28" data-line-number="28"><span class="co">#&gt; 16 0.015           0.015000     FALSE</span></a>
<a class="sourceLine" id="cb12-29" data-line-number="29"><span class="co">#&gt; 17 0.015           0.015000     FALSE</span></a>
<a class="sourceLine" id="cb12-30" data-line-number="30"><span class="co">#&gt; 18 0.015           0.015000     FALSE</span></a>
<a class="sourceLine" id="cb12-31" data-line-number="31"><span class="co">#&gt; 19 1234567890      1234567890   TRUE </span></a>
<a class="sourceLine" id="cb12-32" data-line-number="32"><span class="co">#&gt; 20 1234567890      1234567890   TRUE </span></a>
<a class="sourceLine" id="cb12-33" data-line-number="33"><span class="co">#&gt; 21 1.23            1.230000     FALSE</span></a>
<a class="sourceLine" id="cb12-34" data-line-number="34"><span class="co">#&gt; 22 1.23            1.230000     FALSE</span></a>
<a class="sourceLine" id="cb12-35" data-line-number="35"><span class="co">#&gt; 23 1.23            1.230000     FALSE</span></a></code></pre></div>
<p>MEH. I suspect this is TRUE up to the width/precision of the double-to-string conversion, which inexplicably seems to be different across the two endpoints. It’s too bad that <code>spreadsheets.values.get</code> seems to report <em>greater</em> precision for the literal datetime than <code>spreadsheets.get</code>. It’s hard to understand why the endpoint described as more powerful would have lower precision for any sort of cell.</p>
<p>Claim: cell values returned by <code>spreadsheets.values.get</code> when <code>valueRenderOption = "FORMULA"</code> are same as <code>userEnteredValue</code> from <code>spreadsheets.get</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">  <span class="dt">ss_values_get =</span> val_df<span class="op">$</span>FORMULA,</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">  <span class="dt">ss_get =</span> df<span class="op">$</span>userEnteredValue_value[<span class="op">-</span><span class="dv">1</span>],</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">  <span class="dt">ss_get_type =</span> df<span class="op">$</span>userEnteredValue_name[<span class="op">-</span><span class="dv">1</span>],</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">  <span class="dt">same =</span> ss_values_get <span class="op">==</span><span class="st"> </span>ss_get</a>
<a class="sourceLine" id="cb13-6" data-line-number="6">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="st">  </span><span class="kw">print</span>(<span class="dt">n =</span> <span class="ot">Inf</span>)</a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="co">#&gt; # A tibble: 30 x 4</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="co">#&gt;    ss_values_get   ss_get          ss_get_type  same </span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="co">#&gt;    &lt;chr&gt;           &lt;chr&gt;           &lt;chr&gt;        &lt;lgl&gt;</span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11"><span class="co">#&gt;  1 43169.466099537 43169.466100    numberValue  FALSE</span></a>
<a class="sourceLine" id="cb13-12" data-line-number="12"><span class="co">#&gt;  2 =TODAY()        =TODAY()        formulaValue TRUE </span></a>
<a class="sourceLine" id="cb13-13" data-line-number="13"><span class="co">#&gt;  3 =TODAY()        =TODAY()        formulaValue TRUE </span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14"><span class="co">#&gt;  4 =TODAY()        =TODAY()        formulaValue TRUE </span></a>
<a class="sourceLine" id="cb13-15" data-line-number="15"><span class="co">#&gt;  5 =TODAY()        =TODAY()        formulaValue TRUE </span></a>
<a class="sourceLine" id="cb13-16" data-line-number="16"><span class="co">#&gt;  6 =TODAY()        =TODAY()        formulaValue TRUE </span></a>
<a class="sourceLine" id="cb13-17" data-line-number="17"><span class="co">#&gt;  7 =TODAY()        =TODAY()        formulaValue TRUE </span></a>
<a class="sourceLine" id="cb13-18" data-line-number="18"><span class="co">#&gt;  8 =TODAY()        =TODAY()        formulaValue TRUE </span></a>
<a class="sourceLine" id="cb13-19" data-line-number="19"><span class="co">#&gt;  9 =now()          =now()          formulaValue TRUE </span></a>
<a class="sourceLine" id="cb13-20" data-line-number="20"><span class="co">#&gt; 10 =now()          =now()          formulaValue TRUE </span></a>
<a class="sourceLine" id="cb13-21" data-line-number="21"><span class="co">#&gt; 11 =now()          =now()          formulaValue TRUE </span></a>
<a class="sourceLine" id="cb13-22" data-line-number="22"><span class="co">#&gt; 12 =now()          =now()          formulaValue TRUE </span></a>
<a class="sourceLine" id="cb13-23" data-line-number="23"><span class="co">#&gt; 13 =now()          =now()          formulaValue TRUE </span></a>
<a class="sourceLine" id="cb13-24" data-line-number="24"><span class="co">#&gt; 14 =now()          =now()          formulaValue TRUE </span></a>
<a class="sourceLine" id="cb13-25" data-line-number="25"><span class="co">#&gt; 15 =now()          =now()          formulaValue TRUE </span></a>
<a class="sourceLine" id="cb13-26" data-line-number="26"><span class="co">#&gt; 16 =EDATE(A10, -4) =EDATE(A10, -4) formulaValue TRUE </span></a>
<a class="sourceLine" id="cb13-27" data-line-number="27"><span class="co">#&gt; 17 =EDATE(A11, -4) =EDATE(A11, -4) formulaValue TRUE </span></a>
<a class="sourceLine" id="cb13-28" data-line-number="28"><span class="co">#&gt; 18 =EDATE(A12, -4) =EDATE(A12, -4) formulaValue TRUE </span></a>
<a class="sourceLine" id="cb13-29" data-line-number="29"><span class="co">#&gt; 19 =EDATE(A13, -4) =EDATE(A13, -4) formulaValue TRUE </span></a>
<a class="sourceLine" id="cb13-30" data-line-number="30"><span class="co">#&gt; 20 =EDATE(A14, -4) =EDATE(A14, -4) formulaValue TRUE </span></a>
<a class="sourceLine" id="cb13-31" data-line-number="31"><span class="co">#&gt; 21 =EDATE(A15, -4) =EDATE(A15, -4) formulaValue TRUE </span></a>
<a class="sourceLine" id="cb13-32" data-line-number="32"><span class="co">#&gt; 22 =EDATE(A16, -4) =EDATE(A16, -4) formulaValue TRUE </span></a>
<a class="sourceLine" id="cb13-33" data-line-number="33"><span class="co">#&gt; 23 0.015           0.015000        numberValue  FALSE</span></a>
<a class="sourceLine" id="cb13-34" data-line-number="34"><span class="co">#&gt; 24 0.015           0.015000        numberValue  FALSE</span></a>
<a class="sourceLine" id="cb13-35" data-line-number="35"><span class="co">#&gt; 25 0.015           0.015000        numberValue  FALSE</span></a>
<a class="sourceLine" id="cb13-36" data-line-number="36"><span class="co">#&gt; 26 1234567890      1234567890      numberValue  TRUE </span></a>
<a class="sourceLine" id="cb13-37" data-line-number="37"><span class="co">#&gt; 27 1234567890      1234567890      numberValue  TRUE </span></a>
<a class="sourceLine" id="cb13-38" data-line-number="38"><span class="co">#&gt; 28 1.23            1.230000        numberValue  FALSE</span></a>
<a class="sourceLine" id="cb13-39" data-line-number="39"><span class="co">#&gt; 29 1.23            1.230000        numberValue  FALSE</span></a>
<a class="sourceLine" id="cb13-40" data-line-number="40"><span class="co">#&gt; 30 1.23            1.230000        numberValue  FALSE</span></a></code></pre></div>
<p>MEH. As above, seems to be same content, but with differences in width/precision of doubles.</p>
</div>
<div id="field-mask-and-partial-response" class="section level3">
<h3 class="hasAnchor">
<a href="#field-mask-and-partial-response" class="anchor"></a>Field mask and partial response</h3>
<p><a href="https://developers.google.com/sheets/api/guides/concepts#partial_responses" class="uri">https://developers.google.com/sheets/api/guides/concepts#partial_responses</a></p>
<p>It’s clear I will ultimately use <code>spreadsheets.get</code> for Sheet reading, so here I explore how to control the payload via a field mask. This seems pretty close to what I’ll need to read rectangular regions. Example with the range A2:B3.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="kw">library</span>(gargle)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="co">#(x &lt;- googledrive::drive_get("googlesheets4-design-exploration"))</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="co">#file_id &lt;- x$id</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6">file_id &lt;-<span class="st"> "1xTUxWGcFLtDIHoYJ1WsjQuLmpUtBf--8Bcu5lQ302SU"</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"></a>
<a class="sourceLine" id="cb14-8" data-line-number="8">req &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/gargle/topics/request_develop">request_build</a></span>(</a>
<a class="sourceLine" id="cb14-9" data-line-number="9">  <span class="dt">method =</span> <span class="st">"GET"</span>,</a>
<a class="sourceLine" id="cb14-10" data-line-number="10">  <span class="dt">path =</span> <span class="st">"v4/spreadsheets/{spreadsheetId}"</span>,</a>
<a class="sourceLine" id="cb14-11" data-line-number="11">  <span class="dt">params =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb14-12" data-line-number="12">    <span class="dt">spreadsheetId =</span> file_id,</a>
<a class="sourceLine" id="cb14-13" data-line-number="13">    <span class="co">#ranges = "Sheet1!A:A",</span></a>
<a class="sourceLine" id="cb14-14" data-line-number="14">    <span class="dt">ranges =</span> <span class="st">"Sheet1!A2:B3"</span>,</a>
<a class="sourceLine" id="cb14-15" data-line-number="15">    <span class="co">#includeGridData = TRUE</span></a>
<a class="sourceLine" id="cb14-16" data-line-number="16">    <span class="dt">fields =</span> <span class="st">"spreadsheetId,properties,spreadsheetUrl,sheets.data(startRow,startColumn),sheets.data.rowData.values(formattedValue,userEnteredValue,effectiveValue,effectiveFormat.numberFormat)"</span></a>
<a class="sourceLine" id="cb14-17" data-line-number="17">  ),</a>
<a class="sourceLine" id="cb14-18" data-line-number="18">  <span class="dt">base_url =</span> <span class="st">"https://sheets.googleapis.com"</span>,</a>
<a class="sourceLine" id="cb14-19" data-line-number="19">  <span class="dt">key =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/gargle/topics/gargle_api_key">gargle_api_key</a></span>()</a>
<a class="sourceLine" id="cb14-20" data-line-number="20">)</a>
<a class="sourceLine" id="cb14-21" data-line-number="21">raw_resp &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/gargle/topics/request_make">request_make</a></span>(req)</a>
<a class="sourceLine" id="cb14-22" data-line-number="22">ct &lt;-<span class="st"> </span>httr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/httr/topics/content">content</a></span>(raw_resp)</a></code></pre></div>
<p>Spreadsheet-level metadata:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">  <span class="dt">spreadsheet_id =</span> <span class="st">"spreadsheetId"</span>,</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">  <span class="dt">spreadsheet_url =</span> <span class="st">"spreadsheetUrl"</span>,</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">  <span class="dt">title =</span> <span class="kw">c</span>(<span class="st">"properties"</span>, <span class="st">"title"</span>),</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">  <span class="dt">locale =</span> <span class="kw">c</span>(<span class="st">"properties"</span>, <span class="st">"locale"</span>),</a>
<a class="sourceLine" id="cb15-6" data-line-number="6">  <span class="dt">time_zone =</span> <span class="kw">c</span>(<span class="st">"properties"</span>, <span class="st">"timeZone"</span>)</a>
<a class="sourceLine" id="cb15-7" data-line-number="7">) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="st">  </span><span class="kw">map_chr</span>(<span class="op">~</span><span class="st"> </span>ct[[.x]]) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="st">  </span><span class="kw">enframe</span>()</a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="co">#&gt; # A tibble: 5 x 2</span></a>
<a class="sourceLine" id="cb15-11" data-line-number="11"><span class="co">#&gt;   name            value                                                   </span></a>
<a class="sourceLine" id="cb15-12" data-line-number="12"><span class="co">#&gt;   &lt;chr&gt;           &lt;chr&gt;                                                   </span></a>
<a class="sourceLine" id="cb15-13" data-line-number="13"><span class="co">#&gt; 1 spreadsheet_id  1xTUxWGcFLtDIHoYJ1WsjQuLmpUtBf--8Bcu5lQ302SU            </span></a>
<a class="sourceLine" id="cb15-14" data-line-number="14"><span class="co">#&gt; 2 spreadsheet_url https://docs.google.com/spreadsheets/d/1xTUxWGcFLtDIHoY…</span></a>
<a class="sourceLine" id="cb15-15" data-line-number="15"><span class="co">#&gt; 3 title           googlesheets4-design-exploration                        </span></a>
<a class="sourceLine" id="cb15-16" data-line-number="16"><span class="co">#&gt; 4 locale          en_US                                                   </span></a>
<a class="sourceLine" id="cb15-17" data-line-number="17"><span class="co">#&gt; 5 time_zone       America/Los_Angeles</span></a></code></pre></div>
<p><em>Metadata about the sheets is available here, but my current field mask does not request it. I assume we’ll populate info about the sheets when registering the Sheet, not while reading rectangles.</em></p>
<p>The reply has a component <code>sheets</code>, holding instances of <code>Sheet</code>, one per sheet given in <code>ranges</code> in the request. We have just one because <code>ranges = "Sheet1!A2:B3"</code>. We look at the <code>data</code> component, which contains an instance of <a href="https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets#GridData"><code>GridData</code></a>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">pluck</span>(ct, <span class="st">"sheets"</span>, <span class="dv">1</span>, <span class="st">"data"</span>, <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="st">  </span><span class="kw">str</span>(<span class="dt">max.level =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="co">#&gt; List of 2</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="co">#&gt;  $ startRow: int 1</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="co">#&gt;  $ rowData :List of 2</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="co">#&gt;   ..$ :List of 1</span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="co">#&gt;   ..$ :List of 1</span></a></code></pre></div>
<p>The upper left corner of the rectangle is identified via <code>startRow</code> and <code>startColumn</code>. Both are zero-based and, apparently, are omitted if the value is zero.</p>
<p>The cell data is found within <code>rowData</code>, one object per row and, within that, <code>values</code> and, within that, one instance of <a href="https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets#CellData"><code>CellData</code></a> per cell.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">resp &lt;-<span class="st"> </span>ct <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="st">  </span><span class="kw">pluck</span>(<span class="kw">list</span>(<span class="st">"sheets"</span>, <span class="dv">1</span>, <span class="st">"data"</span>, <span class="dv">1</span>, <span class="st">"rowData"</span>))</a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="kw">str</span>(resp, <span class="dt">max.level =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="co">#&gt; List of 2</span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="co">#&gt;  $ :List of 1</span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="co">#&gt;   ..$ values:List of 2</span></a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="co">#&gt;   .. ..$ :List of 4</span></a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="co">#&gt;   .. ..$ :List of 3</span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="co">#&gt;  $ :List of 1</span></a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="co">#&gt;   ..$ values:List of 2</span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="co">#&gt;   .. ..$ :List of 4</span></a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="co">#&gt;   .. ..$ :List of 3</span></a></code></pre></div>
<p>Here it is, post-rectangling.</p>
<pre><code>#&gt; # A tibble: 4 x 8
#&gt;   cell  enter_type   enter_value effective_type effective_value
#&gt;   &lt;chr&gt; &lt;chr&gt;        &lt;list&gt;      &lt;chr&gt;          &lt;list&gt;         
#&gt; 1 A2    numberValue  &lt;dbl [1]&gt;   numberValue    &lt;dbl [1]&gt;      
#&gt; 2 A3    stringValue  &lt;chr [1]&gt;   stringValue    &lt;chr [1]&gt;      
#&gt; 3 B2    formulaValue &lt;chr [1]&gt;   numberValue    &lt;int [1]&gt;      
#&gt; 4 B3    stringValue  &lt;chr [1]&gt;   stringValue    &lt;chr [1]&gt;      
#&gt; # ... with 3 more variables: formatted_value &lt;chr&gt;, format_type &lt;chr&gt;,
#&gt; #   format_pattern &lt;chr&gt;
#&gt; Observations: 4
#&gt; Variables: 8
#&gt; $ cell            &lt;chr&gt; "A2", "A3", "B2", "B3"
#&gt; $ enter_type      &lt;chr&gt; "numberValue", "stringValue", "formulaValue", ...
#&gt; $ enter_value     &lt;list&gt; [43169.47, "3/10/2018 11:11:11", "=TODAY()", ...
#&gt; $ effective_type  &lt;chr&gt; "numberValue", "stringValue", "numberValue", "...
#&gt; $ effective_value &lt;list&gt; [43169.47, "3/10/2018 11:11:11", 43177, "=TOD...
#&gt; $ formatted_value &lt;chr&gt; "3/10/2018 11:11:11", "3/10/2018 11:11:11", "3...
#&gt; $ format_type     &lt;chr&gt; "DATE_TIME", NA, "DATE", NA
#&gt; $ format_pattern  &lt;chr&gt; "M/d/yyyy H:mm:ss", NA, NA, NA</code></pre>
</div>
</div>
<div id="usage-and-design" class="section level2">
<h2 class="hasAnchor">
<a href="#usage-and-design" class="anchor"></a>Usage and design</h2>
<p>Big question: Will googlesheets4 have a notion of a spreadsheet object?</p>
<div id="peer-packages" class="section level3">
<h3 class="hasAnchor">
<a href="#peer-packages" class="anchor"></a>Peer packages</h3>
<p>What do peer packages do?</p>
<ul>
<li>
<p>No object. Neither readr nor readxl has a notion of a persistent data source. <code><a href="http://www.rdocumentation.org/packages/readr/topics/read_delim">read_csv()</a></code> (and friends) and <code><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">read_excel()</a></code> take a path to a file and return data. That is all.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="kw"><a href="http://www.rdocumentation.org/packages/readr/topics/read_delim">read_csv</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/readr/topics/readr_example">readr_example</a></span>(<span class="st">"mtcars.csv"</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb19-3" data-line-number="3"></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="kw">library</span>(readxl)</a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="kw"><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">read_excel</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/readxl/topics/readxl_example">readxl_example</a></span>(<span class="st">"datasets.xlsx"</span>), <span class="dt">sheet =</span> <span class="st">"mtcars"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">3</span>)</a></code></pre></div>
</li>
<li>
<p>Glorified pointer. googlesheets (the original) has a <code>googlesheet</code> object. It holds the file id and other spreadsheet-specific metadata. You pass this object to <code><a href="http://www.rdocumentation.org/packages/googlesheets/topics/gs_read">gs_read()</a></code>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">library</span>(googlesheets)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">(ss &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/googlesheets/topics/example-sheets">gs_gap</a></span>())</a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="co">#&gt;                   Spreadsheet title: test-gs-gapminder</span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="co">#&gt;                  Spreadsheet author: rpackagetest</span></a>
<a class="sourceLine" id="cb20-5" data-line-number="5"><span class="co">#&gt;   Date of googlesheets registration: 2018-03-20 00:31:02 GMT</span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="co">#&gt;     Date of last spreadsheet update: 2015-04-22 18:27:11 GMT</span></a>
<a class="sourceLine" id="cb20-7" data-line-number="7"><span class="co">#&gt;                          visibility: public</span></a>
<a class="sourceLine" id="cb20-8" data-line-number="8"><span class="co">#&gt;                         permissions: rw</span></a>
<a class="sourceLine" id="cb20-9" data-line-number="9"><span class="co">#&gt;                             version: new</span></a>
<a class="sourceLine" id="cb20-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb20-11" data-line-number="11"><span class="co">#&gt; Contains 5 worksheets:</span></a>
<a class="sourceLine" id="cb20-12" data-line-number="12"><span class="co">#&gt; (Title): (Nominal worksheet extent as rows x columns)</span></a>
<a class="sourceLine" id="cb20-13" data-line-number="13"><span class="co">#&gt; Africa: 625 x 6</span></a>
<a class="sourceLine" id="cb20-14" data-line-number="14"><span class="co">#&gt; Americas: 301 x 6</span></a>
<a class="sourceLine" id="cb20-15" data-line-number="15"><span class="co">#&gt; Asia: 397 x 6</span></a>
<a class="sourceLine" id="cb20-16" data-line-number="16"><span class="co">#&gt; Europe: 361 x 6</span></a>
<a class="sourceLine" id="cb20-17" data-line-number="17"><span class="co">#&gt; Oceania: 25 x 6</span></a>
<a class="sourceLine" id="cb20-18" data-line-number="18"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb20-19" data-line-number="19"><span class="co">#&gt; Key: 1BzfL0kZUz1TsI5zxJF1WNF01IxvC67FbOJUiiGMZ_mQ</span></a>
<a class="sourceLine" id="cb20-20" data-line-number="20"><span class="co">#&gt; Browser URL: https://docs.google.com/spreadsheets/d/1BzfL0kZUz1TsI5zxJF1WNF01IxvC67FbOJUiiGMZ_mQ/</span></a>
<a class="sourceLine" id="cb20-21" data-line-number="21"><span class="kw"><a href="http://www.rdocumentation.org/packages/googlesheets/topics/gs_read">gs_read</a></span>(ss, <span class="dt">ws =</span> <span class="st">"Europe"</span>, <span class="dt">n_max =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb20-22" data-line-number="22"><span class="co">#&gt; Accessing worksheet titled 'Europe'.</span></a>
<a class="sourceLine" id="cb20-23" data-line-number="23"><span class="co">#&gt; Parsed with column specification:</span></a>
<a class="sourceLine" id="cb20-24" data-line-number="24"><span class="co">#&gt; cols(</span></a>
<a class="sourceLine" id="cb20-25" data-line-number="25"><span class="co">#&gt;   country = col_character(),</span></a>
<a class="sourceLine" id="cb20-26" data-line-number="26"><span class="co">#&gt;   continent = col_character(),</span></a>
<a class="sourceLine" id="cb20-27" data-line-number="27"><span class="co">#&gt;   year = col_double(),</span></a>
<a class="sourceLine" id="cb20-28" data-line-number="28"><span class="co">#&gt;   lifeExp = col_double(),</span></a>
<a class="sourceLine" id="cb20-29" data-line-number="29"><span class="co">#&gt;   pop = col_double(),</span></a>
<a class="sourceLine" id="cb20-30" data-line-number="30"><span class="co">#&gt;   gdpPercap = col_double()</span></a>
<a class="sourceLine" id="cb20-31" data-line-number="31"><span class="co">#&gt; )</span></a>
<a class="sourceLine" id="cb20-32" data-line-number="32"><span class="co">#&gt; # A tibble: 3 x 6</span></a>
<a class="sourceLine" id="cb20-33" data-line-number="33"><span class="co">#&gt;   country continent  year lifeExp      pop gdpPercap</span></a>
<a class="sourceLine" id="cb20-34" data-line-number="34"><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb20-35" data-line-number="35"><span class="co">#&gt; 1 Albania Europe    1952.    55.2 1282697.     1601.</span></a>
<a class="sourceLine" id="cb20-36" data-line-number="36"><span class="co">#&gt; 2 Albania Europe    1957.    59.3 1476505.     1942.</span></a>
<a class="sourceLine" id="cb20-37" data-line-number="37"><span class="co">#&gt; 3 Albania Europe    1962.    64.8 1728137.     2313.</span></a></code></pre></div>
</li>
<li><p>More glorified pointer. googledrive has a <code>dribble</code> object. A key feature is that it’s built to hold many files at once, as rows in the dribble. It has no notion of file type. Columns are file id, file title, and a hairy list-column.</p></li>
<li><p>Persistent, mutable spreadsheet object. The (currently dormant) <a href="https://github.com/rsheets">rsheets effort</a> spec’d out a <em>linen object</em>: an R6 data structure to hold a spreadsheet. Rich Fitzjohn implemented it for Excel spreadsheets, but it was absolutely designed with Google Sheets in mind, too. The spreadsheet object has document-level metadata, holds individual worksheets, and can accomodate cell data and, even, formatting. The idea was to read everything out of the spreadsheet all at once and then work with the linen object for downstream operations. This supports, for example, shared infrastructure for dealing with common spreadsheet aggravations.</p></li>
</ul>
</div>
<div id="more-thoughts" class="section level3">
<h3 class="hasAnchor">
<a href="#more-thoughts" class="anchor"></a>More thoughts</h3>
<p>A spreadsheet is more like a database with multiple tables than a csv file. Which suggests it’s not crazy to think of establishing a connection, then reading from and writing to the different tables within it.</p>
<p>readxl and readr are read-only and the target files tend to be local and static. In contrast, googlesheets4 will be read/write and the target file is more volatile. I feel like this supports the use of a persistent object, but I can’t say exactly why.</p>
<p>File id is the only thing that can’t change about a Google Sheet. Even if we augment the file id with other metadata, at request time, there’s no guarantee that the metadata is still accurate.</p>
<ul>
<li>Storing the file name along with the id just seems humane. It will almost always be correct.</li>
<li>It’s very nice to have an overview of the worksheets: name, extent. Even readxl will list the worksheet names for you (<code><a href="http://www.rdocumentation.org/packages/readxl/topics/excel_sheets">readxl::excel_sheets()</a></code>).</li>
<li>How much do we rely on the most recent metadata versus dutifully update? For example, when asked to read a specific worksheet, do we just try or do we use current or refreshed metadata to first establish that the worksheet actually exists?</li>
</ul>
<p>These are related, but distinct, and shouldn’t be conflated:</p>
<ul>
<li>Registering a spreadsheet as a pointer-with-metadata.
<ul>
<li>Example: current googlesheet object.</li>
</ul>
</li>
<li>Capturing an exhaustive snapshot of a spreadsheet or a worksheet as an R object that is intelligible and amenable to further manipulation. The linen object is an example. A lower-tech example is the tibble returned by <code><a href="http://www.rdocumentation.org/packages/googlesheets/topics/gs_read_cellfeed">googlesheets::gs_read_cellfeed()</a></code>. It has one row per cell and columns for, e.g., cell reference, various forms of cell contents, and cell formatting.</li>
</ul>
<p>googlesheets makes data immediately available in two forms:</p>
<ul>
<li>A data frame with same “shape” as the Sheet. Defaults to formatted cell contents, but <code><a href="http://www.rdocumentation.org/packages/googlesheets/topics/gs_read">gs_read(..., literal = FALSE)</a></code> requests unformatted contents.</li>
<li>A data frame with one row per cell via <code><a href="http://www.rdocumentation.org/packages/googlesheets/topics/gs_read_cellfeed">gs_read_cellfeed()</a></code>, with cell location data and cell contents in three forms (“literal value” = formatted, “input value” = (sort of) what was typed, “numeric value” = actual numeric value).</li>
</ul>
<p>In fact, in general <code><a href="http://www.rdocumentation.org/packages/googlesheets/topics/gs_read">gs_read()</a></code> is a call to <code><a href="http://www.rdocumentation.org/packages/googlesheets/topics/gs_read_cellfeed">gs_read_cellfeed()</a></code> followed by a call to <code><a href="http://www.rdocumentation.org/packages/googlesheets/topics/gs_reshape_cellfeed">gs_reshape_cellfeed()</a></code> (which reshapes and enforces col types). This seems like a good design, i.e. to expose the “one row per cell” form, but offer a nice wrapper that does the reshaping.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#peer-group">Peer group</a></li>
      <li><a href="#col-spec">Col spec</a></li>
      <li><a href="#parsing">Parsing</a></li>
      <li><a href="#guessing">Guessing</a></li>
      <li><a href="#google-sheet-cell-data-from-sheets-api-v4">Google Sheet cell data from Sheets API v4</a></li>
      <li><a href="#usage-and-design">Usage and design</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Jennifer Bryan, <a href="https://www.rstudio.com"><img src="http://tidyverse.org/rstudio-logo.svg" alt="RStudio" height="24"></a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
